
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Schomart Signup/Login</title>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBEJOF1jZAIIV8_i6xvUHlSKeqOlcQ-Sgo",
      authDomain: "schomart-7a743.firebaseapp.com",
      projectId: "schomart-7a743",
      storageBucket: "schomart-7a743.appspot.com",
      messagingSenderId: "20119186662",
      appId: "1:20119186662:web:da1755b55dacde4fa6df27",
      measurementId: "G-9QGL3XHSC7"
};
    firebase.initializeApp(firebaseConfig);
  </script>
</head>
<body>
  <h2>Signup</h2>
  <input type="text" id="signupEmail" placeholder="Email"><br>
  <input type="text" id="signupUsername" placeholder="Username"><br>
  <input type="password" id="signupPassword" placeholder="Password"><br>
  <button onclick="signup()">Sign Up</button>

  <h2>Login</h2>
  <input type="text" id="loginEmail" placeholder="Email"><br>
  <input type="password" id="loginPassword" placeholder="Password"><br>
  <button onclick="login()">Log In</button>

  <script>
    async function signup() {
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      const username = document.getElementById('signupUsername').value;

      try {
        const userCredential = await firebase.auth().createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const idToken = await user.getIdToken();

        // Send user data to backend
        const response = await fetch('/api/signup', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json'},
          body: JSON.stringify({
            uid: user.uid,
            email: user.email,
            username: username,
            referralCode: new URLSearchParams(window.location.search).get('ref') || null
})
});

        const result = await response.json();
        if (response.ok) {
          alert('Signup successful!');
} else {
          alert('Signup failed: ' + result.error);
}
} catch (error) {
        alert('Signup error: ' + error.message);
}
}

    async function login() {
      const email = document.getElementById('loginEmail').value;
      const password = document.getElementById('loginPassword').value;

      try {
        const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        const idToken = await user.getIdToken();

        // Verify token with backend
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json'},
          body: JSON.stringify({ idToken})
});

        const result = await response.json();
        if (response.ok) {
          alert('Login successful!');
          // Example: fetch protected profile
          const profileRes = await fetch('/profile', {
            headers: { 'Authorization': 'Bearer ' + idToken}
});
          const profileData = await profileRes.json();
          console.log('Profile:', profileData);
} else {
          alert('Login failed: ' + result.error);
}
} catch (error) {
        alert('Login error: ' + error.message);
}
}
  </script>
</body>
</html>
