<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Reported Advert Details</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .top-navigation {
            display: flex;
            justify-content: flex-start;
            gap: 15px;
            margin-bottom: 20px;
        }
        .top-navigation a {
            background-color: #006B3C;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
            font-size: 16px;
            transition: background-color 0.3s ease;
        }
        .top-navigation a:hover {
            background-color: #FDB813;
            color: #000;
        }
        h1, h2 {
            color: #006B3C;
            margin-bottom: 15px;
            border-bottom: 2px solid #eee;
            padding-bottom: 10px;
        }
        .detail-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #f9f9f9;
        }
        .detail-section p {
            margin-bottom: 8px;
        }
        .detail-section strong {
            display: inline-block;
            width: 120px;
            font-weight: bold;
            color: #555;
        }
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 30px;
            justify-content: center;
        }
        .action-buttons button {
            background-color: #006B3C;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .action-buttons button:hover {
            background-color: #FDB813;
            color: #000;
            transform: translateY(-2px);
        }
        .action-buttons button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .action-buttons button.danger {
            background-color: #dc3545;
        }
        .action-buttons button.danger:hover {
            background-color: #c82333;
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border: 1px solid #888;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            position: relative;
        }
        .modal-content h3 {
            color: #006B3C;
            margin-bottom: 20px;
        }
        .modal-content p {
            margin-bottom: 20px;
        }
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .modal-buttons button {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            border: none;
        }
        .modal-buttons button.confirm {
            background-color: #28a745;
            color: white;
        }
        .modal-buttons button.confirm:hover {
            background-color: #218838;
        }
        .modal-buttons button.cancel {
            background-color: #6c757d;
            color: white;
        }
        .modal-buttons button.cancel:hover {
            background-color: #5a6268;
        }
        .close-button {
            position: absolute;
            top: 10px;
            right: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-button:hover,
        .close-button:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        .flash-messages {
            list-style: none;
            padding: 0;
            margin: 20px 0;
        }
        .flash-messages li {
            padding: 10px 20px;
            margin-bottom: 10px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }
        .flash-messages li.error { background-color: #dc3545; }
        .flash-messages li.success { background-color: #28a745; }
        .flash-messages li.info { background-color: #17a2b8; }
        .flash-messages li.warning { background-color: #ffc107; color: #333;}
    </style>
</head>
<body>
    {% extends "base.html" %}

    {% block title %}Admin - Reported Advert Details{% endblock %}

    {% block content %}
    <div class="container">
        <div class="top-navigation">
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('reported_adverts_admin') }}">Back to Reported Adverts</a>
        </div>

        <h1>Report Details (#{{ report.report_id }})</h1>

        <div class="detail-section">
            <h2>Report Information</h2>
            <p><strong>Report ID:</strong> {{ report.report_id }}</p>
            <p><strong>Reported At:</strong> {{ report.reported_at.strftime('%Y-%m-%d %H:%M:%S') }}</p>
            <p><strong>Reason:</strong> {{ report.reason }}</p>
        </div>

        <div class="detail-section">
            <h2>Advert Information</h2>
            <p><strong>Advert ID:</strong> {{ report.advert_id }}</p>
            <p><strong>Title:</strong> {{ report.advert_title }}</p>
            <p><strong>Description:</strong> {{ report.advert_description }}</p>
            <p><strong>Price:</strong> â‚¦{{ "{:,}".format(report.advert_price) }}</p>
            <p><strong>Current Status:</strong> <span style="font-weight: bold; color: {{ 'red' if report.advert_status == 'taken_down' or report.advert_status == 'rejected' else 'green' }};">{{ report.advert_status.replace('_', ' ').title() }}</span></p>
            <p><strong>Owned by:</strong> <a href="{{ url_for('profile', user_id=report.advert_owner_id) }}" target="_blank">{{ report.advert_owner_username }}</a> (ID: {{ report.advert_owner_id }})</p>
            <p><strong>Owner Email:</strong> {{ report.advert_owner_email }}</p>
            <p><strong>Owner Account Status:</strong> <span style="font-weight: bold; color: {{ 'red' if report.advert_owner_account_status == 'suspended' else 'green' }};">{{ report.advert_owner_account_status.title() }}</span></p>
        </div>

        <div class="detail-section">
            <h2>Reporter Information</h2>
            <p><strong>Reporter ID:</strong> {{ report.reporter_id }}</p>
            <p><strong>Username:</strong> <a href="{{ url_for('profile', user_id=report.reporter_id) }}" target="_blank">{{ report.reporter_username }}</a></p>
            <p><strong>Email:</strong> {{ report.reporter_email }}</p>
            <p><strong>Account Status:</strong> <span style="font-weight: bold; color: {{ 'red' if report.reporter_account_status == 'suspended' else 'green' }};">{{ report.reporter_account_status.title() }}</span></p>
        </div>

        <div class="action-buttons">
            <button onclick="showConfirmationModal('mark_resolved', {{ report.report_id }})">Mark Resolved</button>
            <button onclick="showConfirmationModal('suspend_user', {{ report.advert_owner_id }})" class="danger">Suspend Advert Owner</button>
            <button onclick="showConfirmationModal('suspend_user', {{ report.reporter_id }})" class="danger">Suspend Reporter</button>
            <button onclick="showConfirmationModal('take_down_advert', {{ report.advert_id }})" class="danger">Take Down Advert</button>
        </div>
    </div>

    <!-- Confirmation Modal Structure -->
    <div id="confirmationModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="hideConfirmationModal()">&times;</span>
            <h3>Confirm Action</h3>
            <p id="modalMessage"></p>
            <div class="modal-buttons">
                <button class="confirm" id="confirmActionButton">Confirm</button>
                <button class="cancel" onclick="hideConfirmationModal()">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let currentAction = null;
        let currentId = null;

        function showConfirmationModal(action, id) {
            currentAction = action;
            currentId = id;
            let message = '';

            if (action === 'mark_resolved') {
                message = `Are you sure you want to mark report #${id} as resolved? This action is irreversible.`;
            } else if (action === 'suspend_user') {
                message = `Are you sure you want to suspend user ID #${id}? Their account will be deactivated.`;
            } else if (action === 'take_down_advert') {
                message = `Are you sure you want to take down advert ID #${id}? It will no longer be visible.`;
            }

            document.getElementById('modalMessage').innerText = message;
            document.getElementById('confirmationModal').style.display = 'block';
        }

        function hideConfirmationModal() {
            document.getElementById('confirmationModal').style.display = 'none';
            currentAction = null;
            currentId = null;
        }

        document.getElementById('confirmActionButton').addEventListener('click', async () => {
            hideConfirmationModal(); // Hide modal immediately

            let url = '';
            let successMessage = '';
            let errorMessage = '';

            if (currentAction === 'mark_resolved') {
                url = `/admin/action/mark_resolved/${currentId}`;
                successMessage = 'Report marked as resolved!';
                errorMessage = 'Failed to mark report as resolved.';
            } else if (currentAction === 'suspend_user') {
                url = `/admin/action/suspend_user/${currentId}`;
                successMessage = `User #${currentId} suspended!`;
                errorMessage = 'Failed to suspend user.';
            } else if (currentAction === 'take_down_advert') {
                url = `/admin/action/take_down_advert/${currentId}`;
                successMessage = `Advert #${currentId} taken down!`;
                errorMessage = 'Failed to take down advert.';
            }

            try {
                const response = await fetch(url, { method: 'POST' });
                const data = await response.json();

                if (response.ok) {
                    // Display success message using Flask's flash system (requires reload or new AJAX handling)
                    // For immediate visual feedback without reload:
                    alert(data.message || successMessage);
                    // Optionally, disable/hide the button or update status on the page
                    // window.location.reload(); // Consider reloading the page to show updated status
                } else {
                    alert('Error: ' + (data.message || errorMessage));
                }
            } catch (error) {
                console.error('Fetch error:', error);
                alert('An unexpected error occurred. Please try again.');
            }
        });

        // Close modal if user clicks outside of it
        window.onclick = function(event) {
            const modal = document.getElementById('confirmationModal');
            if (event.target === modal) {
                hideConfirmationModal();
            }
        };
    </script>
    {% endblock %}
</body>
</html>
